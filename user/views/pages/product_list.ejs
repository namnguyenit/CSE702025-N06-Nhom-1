<%- include('../partials/header', { title: title }) %>

<!-- Category Filter Bar -->
<div class="product-filter-bar d-flex justify-content-between align-items-center mb-4" style="border-bottom:1px solid #eee; padding-bottom:10px;">
    <div class="product-categories d-flex align-items-center">
        <a href="?" class="mr-4 <%= !currentCategory ? 'active' : '' %>">All</a>
        <a href="?category=new" class="mr-4 <%= currentCategory==='new' ? 'active' : '' %>">New</a>
        <a href="?category=featured" class="mr-4 <%= currentCategory==='featured' ? 'active' : '' %>">Featured</a>
        <a href="?category=offer" class="mr-4 <%= currentCategory==='offer' ? 'active' : '' %>">Offer</a>
    </div>
    <div class="product-sort d-flex align-items-center">
        <span class="mr-2">Short by:</span>
        <form method="get" class="mb-0">
            <select name="sort" class="form-control form-control-sm d-inline w-auto" onchange="this.form.submit()">
                <option value="featured" <%= currentSort==='featured' ? 'selected' : '' %>>Featured</option>
                <option value="name_asc" <%= currentSort==='name_asc' ? 'selected' : '' %>>Name A-Z</option>
                <option value="name_desc" <%= currentSort==='name_desc' ? 'selected' : '' %>>Name Z-A</option>
            </select>
            <% if (searchQuery) { %><input type="hidden" name="search" value="<%= searchQuery %>"><% } %>
            <% if (currentCategory) { %><input type="hidden" name="category" value="<%= currentCategory %>"><% } %>
        </form>
    </div>
</div>

<div class="slider-area ">
    <div class="single-slider slider-height2 d-flex align-items-center" data-background="/img/hero/category.jpg"> <div class="container">
            <div class="row">
                <div class="col-xl-12">
                    <div class="hero-cap text-center">
                        <h2><%= title %></h2>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<section class="lattest-product-area pb-40 category-list">
    <div class="container">
        <div class="row">
            <div class="col-xl-12 col-lg-12 col-md-12">
                <div class="row">
                    <% if (typeof products !== 'undefined' && products.length > 0) { %>
                        <% products.forEach(product => { %>
                            <div class="col-xl-4 col-lg-6 col-md-6 col-sm-6"> <%- include('../partials/product_card', { product: product }) %>
                            </div>
                        <% }); %>
                    <% } else { %>
                        <div class="col-12">
                            <p class="text-center">Không tìm thấy sản phẩm nào phù hợp.</p>
                        </div>
                    <% } %>
                </div>
                <% if (lastPage > 1) { %>
                    <nav class="blog-pagination justify-content-center d-flex">
                        <ul class="pagination">
                            <% if (hasPreviousPage) { %>
                                <li class="page-item">
                                    <a href="?page=<%= previousPage %><%- searchQuery ? '&search='+searchQuery : '' %><%- currentSort ? '&sort='+currentSort : '' %>" class="page-link" aria-label="Previous">
                                        <i class="ti-angle-left"></i>
                                    </a>
                                </li>
                            <% } else { %>
                                <li class="page-item disabled"><span class="page-link"><i class="ti-angle-left"></i></span></li>
                            <% } %>
                            <% for (let i = 1; i <= lastPage; i++) { %>
                                <% if (i === currentPage) { %>
                                    <li class="page-item active"><span class="page-link"><%= i %></span></li>
                                <% } else { %>
                                    <li class="page-item">
                                        <a href="?page=<%= i %><%- searchQuery ? '&search='+searchQuery : '' %><%- currentSort ? '&sort='+currentSort : '' %>" class="page-link"><%= i %></a>
                                    </li>
                                <% } %>
                            <% } %>
                            <% if (hasNextPage) { %>
                                <li class="page-item">
                                    <a href="?page=<%= nextPage %><%- searchQuery ? '&search='+searchQuery : '' %><%- currentSort ? '&sort='+currentSort : '' %>" class="page-link" aria-label="Next">
                                        <i class="ti-angle-right"></i>
                                    </a>
                                </li>
                            <% } else { %>
                                <li class="page-item disabled"><span class="page-link"><i class="ti-angle-right"></i></span></li>
                            <% } %>
                        </ul>
                    </nav>
                <% } %>
            </div>
        </div>
    </div>
</section>
<%- include('../partials/footer') %>